<html>

<?php
session_start();

$con = mysqli_connect('localhost', 'root', '');
mysqli_select_db($con, 'siteweb');
?>

<head>
<title> Page d'accueil </title>
<meta charset="UTF8" />
<link rel="stylesheet" href="design/design.css" />

<link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css" />
<script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"></script>
</head>

<body>

<div class="barrehaut">
<div class="barrehautinterieur">

  <img src="design/images/logot.png" alt="logo" class="barrehautinterieurlogo">
  <?php if (isset($_SESSION['valide'])): ?>
  <a href="session/sessionstop.php">SE DECONNECTER</a>
  <a href="profil.php">MON PROFIL</a>
  <?php endif ?>
  <a href="matchs/tournois.php">TOURNOIS</a>
  <a class="active" href="accueil.html">PAGE D'ACCUEIL</a>

</div>
</div>

<?php if (isset($_SESSION['valide'])): ?>

<?= $_SESSION['email']; ?>
<?= $_SESSION['motdepasse']; ?>
<?= $_SESSION['nom']; ?>
<?= $_SESSION['prenom']; ?>
<?= $_SESSION['date_naissance']; ?>
<?= $_SESSION['telephone']; ?>

<div class="corpsbaslarge">

<!-- Carousel d'image -->

<!-- Les slides -->
<div class="slideshow-container">

  <div class="mySlides fade">
    <div class="numbertext">1 / 3</div>
    <div style="background-image:url('design/images/slide4.jpg'); background-size: cover; width:100%; height:100%;"></div>
    <div class="text">Faculté des Sciences</div>
  </div>

  <div class="mySlides fade">
    <div class="numbertext">2 / 3</div>
    <div style="background-image:url('design/images/slide5.jpg'); background-size: cover; width:100%; height:100%;"></div>
    <div class="text">Stade de la Mosson à Montpellier</div>
  </div>

  <div class="mySlides fade">
    <div class="numbertext">3 / 3</div>
    <div style="background-image:url('design/images/slide6.jpg'); background-size: cover; width:100%; height:100%;"></div>
    <div class="text">Open Sud à Montpellier (Tennis)</div>
  </div>

  <!-- Next and previous buttons -->
  <a class="prev" onclick="plusSlides(-1)">&#10094;</a>
  <a class="next" onclick="plusSlides(1)">&#10095;</a>
</div>
<br>

<!-- The dots/circles -->
<div style="text-align:center">
  <span class="dot" onclick="currentSlide(1)"></span>
  <span class="dot" onclick="currentSlide(2)"></span>
  <span class="dot" onclick="currentSlide(3)"></span>
</div>

<script>
var slideIndex = 1;
showSlides(slideIndex);

function plusSlides(n) {
  showSlides(slideIndex += n);
}

function currentSlide(n) {
  showSlides(slideIndex = n);
}

function showSlides(n) {
  var i;
  var slides = document.getElementsByClassName("mySlides");
  var dots = document.getElementsByClassName("dot");
  if (n > slides.length) {slideIndex = 1}    
  if (n < 1) {slideIndex = slides.length}
  for (i = 0; i < slides.length; i++) {
      slides[i].style.display = "none";  
  }
  for (i = 0; i < dots.length; i++) {
      dots[i].className = dots[i].className.replace(" active", "");
  }
  slides[slideIndex-1].style.display = "block";  
  dots[slideIndex-1].className += " active";
}
</script>

<!-- Code de la carte -->

<div id="map" class="map"></div>

<script type="text/javascript">
var map = L.map('map').setView([43.632402, 3.863267], 13);

L.tileLayer('https://api.maptiler.com/maps/streets/{z}/{x}/{y}.png?key=pS1vThRcxhXotG2dY7xf').addTo(map);

var marker = L.marker([43.632402, 3.863267],
            {draggable: false,
            title: 'Hover Text',
            opacity: 1}
            )
            .addTo(map)
            .bindPopup("<b>Faculté</b><br>des Sciences de Montpellier")
            .openPopup();
</script>

<?php
$t = "SELECT * FROM tournoi";
$tournois = mysqli_query($con, $t);
?>

<?php foreach ($tournois as $tournoi ) : ?>
<?php
$lieu = $tournoi['lieu'];

$la = "SELECT latitude FROM lieu WHERE lieu_nom = '$lieu'";
$lat = mysqli_query($con, $la);
$latitude = mysqli_fetch_array($lat);

$lo = "SELECT longitude FROM lieu WHERE lieu_nom = '$lieu'";
$lon = mysqli_query($con, $lo);
$longitude = mysqli_fetch_array($lon);
?>

<script type="text/javascript">
var marker = L.marker([<?= $latitude[0] ?>, <?= $longitude[0] ?>],
            {draggable: false,
            title: 'Hover Text',
            opacity: 0.5}
            )
            .addTo(map)
            .bindPopup("<b><?=  $tournoi['lieu'] ?></b><br>Tournoi : <?=  $tournoi['id_tournoi'] ?><br>Date de début : <?=  $tournoi['date_debut'] ?><br>Durée : <?=  $tournoi['duree'] ?>")
            .openPopup();
</script>
<?php endforeach; ?>

<!-- Fin de code de la carte -->

</div>

<?php else: ?>
<div class="corpsbas">
<div class="partie1">
Connectez-vous
</div>
<div class="partie2">
Connectez-vous pour pouvoir accéder à votre profil, voir vos tournois et pouvoir gérer les tournois selon les droits que vous possédez.
Si vous ne possédez pas de compte, inscrivez-vous. 
</div>
<div class="partie3">
<div class="insc" onclick="location.href='connexion_inscription/inscription.html';">Inscription</div>
<div class="connect" onclick="location.href='connexion_inscription/connexion.html';">Connexion</div>
</div>
</div>
<?php endif ?>

</body>

</html>